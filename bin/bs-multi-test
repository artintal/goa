#!/bin/bash
#
# Usage: bs-multi-inputs N original evolved
#   Run ORIGINAL and EVOLVED blackscholes over inputs ranging
#   from size of 10 to 10^N.  Print stats to STDOUT
#
. $(dirname $0)/common
N=$1
ORIG=$2
EVOL=$3

uniform(){ awk -F, '{print $2,$1}'|sort; }

for exp in $(seq 1 $N);do
    size=$(echo "10^$exp"|bc)
    ifile="/tmp/$size.in"
    ofile="/tmp/$size.out"
    echo ""
    echo "size,$size"
    inputgen $size $ifile
    O_OUT=$(run blackscholes $ORIG -i $ifile -p -k)
    tmp=$(echo "$O_OUT"|grep output|sed 's/^.* //')
    mv $tmp $ofile
    E_OUT=$(run blackscholes $EVOL -i $ifile -o $ofile -p)
    join <(echo "$O_OUT"|grep -v output|uniform) <(echo "$E_OUT"|uniform) \
        |sed 's/ /,/g'
    rm -f $ifile $ofile
done
