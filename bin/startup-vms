#!/bin/sh
#
# Usage: startup-vms NUM
# start up all NUM VM overlays
#
# NUM - number of machines to start up
# 
. $(dirname $0)/common

if [ ! $(basename $(pwd)) == "optimization" ];then
    echo "must run this from the optimization directory" >&2;
    exit 1
fi

for i in $(seq $1);do
    I=$(printf "%0.2d" $i);
    echo "starting $I"
    qemu-kvm -hda overlays/$I.qcow -m 2G \
        -cdrom data/debian-5010-amd64-netinst.iso \
        -net nic -net user,hostfwd=tcp:127.0.0.1:30$I-:22 \
        -nographic -daemonize || error "error starting $I"
done
reset
exit 0
