#!/bin/bash
#
# Usage: active-vms
# List the active vms and their ports
#
#  TODO: would be nice to fold this into the top output to mark each
#        VM as active or inactive e.g., CPU usage above or below 50%
#
. bin/common
ps ax -o pcpu,pid,args|grep -v grep|grep qemu-kvm|grep hostfwd \
    |sed 's/qemu-kvm -hda //;s/\.qcow.*127.0.0.1:/ /;s/-:22.*$//;' \
    |sort -rn
